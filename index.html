<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Character encoding for the document -->
    <meta charset="UTF-8" />

    <!-- Responsive design settings to ensure proper rendering on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Compatibility settings for Internet Explorer -->
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    <!-- Link to Bootstrap CSS for styling the page -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <!-- Link to Bootstrap Icons for using icon fonts -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />

    <!-- Link to custom stylesheet for additional styles specific to the Blackjack game -->
    <link rel="stylesheet" href="css/blackjack_style.css" />

    <!-- Title of the webpage, displayed in the browser tab -->
    <title>Blackjack</title>
  </head>

  <body>
    <audio id="bg-music"></audio>

    <audio id="vfx-sounds"></audio>

    <!-- Header section containing the game title -->
    <header class="container text-white text-center mb-4">
      <h1>üÉè Blackjack 25 üÉè</h1>
    </header>

    <main class="container text-white">
      <!-- Betting and money area -->
      <section id="betting" class="text-center mb-4">
        <h4>üí∞ Balance: <span id="money-display">1000</span>$</h4>
        <label for="bet-input">Place your bet:</label>
        <input
          type="number"
          id="bet-input"
          min="1"
          max="1000"
          step="1"
          value="10"
          style="width: 80px; margin: 0 8px"
        />
        <button class="btn btn-warning btn-sm" onclick="placeBetAndStart()">
          Bet & Deal
        </button>
      </section>

      <!-- Main game section -->
      <section id="game">
        <!-- Dealer area -->
        <div class="hand-area dealer-area">
          <h2><i class="bi bi-person-heart"></i> Dealer</h2>
          <div id="dealer"></div>
        </div>

        <!-- Controls area -->
        <div class="controls">
          <!-- Button for the player to draw a new card -->
          <button
            class="btn btn-primary btn-custom"
            id="card"
            type="button"
            onclick="
            playerNewCard();
            playCardSoundDontWait();
            "
          >
            <i class="bi bi-plus-circle"></i> Card
          </button>

          <!-- Button for the player to stand (end their turn) -->
          <button
            class="btn btn-secondary btn-custom"
            id="stand"
            type="button"
            onclick="dealerFinish()"
          >
            <i class="bi bi-hand-thumbs-up"></i> Stand
          </button>

          <!-- Button to start a new game, initially disabled -->
          <button
            class="btn btn-success btn-custom"
            id="new_game"
            type="button"
            onclick="newGameBasicOrAdvanced()"
            disabled
          >
            <i class="bi bi-arrow-clockwise"></i> New Game
          </button>
        </div>

        <!-- Player area -->
        <div class="hand-area player-area">
          <h2 id="playerNameDisplay">
            <i class="bi bi-person-fill"></i> Player
          </h2>
          <div id="player"></div>
        </div>
      </section>

      <!-- Section to display the game's status and messages -->
      <section id="game_status" class="text-white">
        <!-- This will be populated dynamically during the game -->
      </section>

      <!-- Debugging section for developers to view game state -->
      <section id="sec_debug" class="text-white">
        <h2><i class="bi bi-bug"></i> Debug</h2>
        <p id="debug">
          <!-- Placeholder for displaying debug information -->
        </p>
      </section>
    </main>

    <!-- Footer section, currently empty -->
    <footer class="container text-white">
      <!-- Any footer content can be added here -->
    </footer>

    <!-- ===== GAME START MENU OVERLAY ===== -->
    <div id="start-menu">
      <div id="start-menu-content" class="text-center text-light p-4 rounded">
        <h2 class="mb-4">Blackjack 25</h2>

        <div class="input-group mb-4">
          <input
            type="text"
            id="player-name"
            class="form-control"
            placeholder="Your player name here"
            aria-label="Player name"
          />
          <button id="btn-name-submit" class="btn btn-primary" type="button">
            Enter
          </button>
        </div>

        <button id="btn-start" class="btn btn-success w-100 mb-3">
          Start Basic Game
        </button>

        <button id="btn-start-advanced" class="btn btn-warning w-100 mb-3">
          Start Advanced Game
        </button>

        <button id="btn-quit" class="btn btn-danger w-100">Quit</button>
      </div>
    </div>

    <!-- ===== SHOP MENU ===== -->
    <div id="shop-menu" style="display: none">
      <div id="shop-menu-content" class="text-center text-light p-4 rounded">
        <h2>Shop</h2>
        <p>
          Welcome to the shop! Here you can buy items and abilities to help with
          your game.
        </p>

        <!-- Shop Power-Up: Reveal Hidden Card -->
        <div class="shop-item" id="shop-reveal">
          <div class="shop-icon-container">
            <!-- Eye icon (for Reveal Hidden Card) -->
            <i class="bi bi-eye-fill shop-icon"></i>

            <!-- Price for the item -->
            <span class="shop-price" id="shop-reveal-price">10$</span>
          </div>
          <div class="shop-text">
            <p>Reveal Hidden Card</p>
          </div>
          <button
            class="btn btn-primary w-100 shop-btn"
            id="buy-shop-reveal"
            disabled
          >
            Buy item
          </button>
        </div>

        <!-- Shop Power-Up: Compass Intuition -->
        <div class="shop-item" id="shop-compass">
          <div class="shop-icon-container">
            <i class="bi bi-compass shop-icon"></i>
            <span class="shop-price" id="shop-compass-price">50$</span>
          </div>
          <div class="shop-text">
            <p>Compass Intuition</p>
          </div>
          <button
            class="btn btn-primary w-100 shop-btn"
            id="buy-shop-compass"
            disabled
          >
            Buy item
          </button>
        </div>

        <!-- Shop Power-Up: Lightning Strike -->
        <div class="shop-item" id="shop-lightning">
          <div class="shop-icon-container">
            <i class="bi bi-lightning shop-icon"></i>
            <span class="shop-price" id="shop-lightning-price">100$</span>
          </div>
          <div class="shop-text">
            <p>Lightning Strike</p>
          </div>
          <button
            class="btn btn-primary w-100 shop-btn"
            id="buy-shop-lightning"
            disabled
          >
            Buy item
          </button>
        </div>

        <!-- Shop Power-Up: Quick Inspect -->
        <div class="shop-item" id="shop-quick-inspect">
          <div class="shop-icon-container">
            <i class="bi bi-search shop-icon"></i>
            <span class="shop-price" id="shop-quick-inspect-price">300$</span>
          </div>
          <div class="shop-text">
            <p>Quick Inspect</p>
          </div>
          <button
            class="btn btn-primary w-100 shop-btn"
            id="buy-shop-quick-inspect"
            disabled
          >
            Buy item
          </button>
        </div>

        <!-- Shop Lootbox -->
        <div class="shop-item" id="shop-lootbox">
          <div class="shop-icon-container">
            <i class="bi bi-gift shop-icon"></i>
            <span class="shop-price" id="shop-lootbox-price">150$</span>
          </div>
          <div class="shop-text">
            <p>???</p>
          </div>
          <button
            class="btn btn-primary w-100 shop-btn"
            id="buy-shop-lootbox"
            disabled
          >
            Buy item
          </button>
        </div>


        <!-- Add more items here if needed -->
        <!-- e.g., another power-up or shop item -->

        <!-- Button to leave the shop -->
        <button id="leave-shop-btn" class="btn btn-danger mt-3 w-100">
          Leave Shop
        </button>
      </div>
    </div>

    <!-- ===== POWER UPS MENU ===== -->
    <div id="powerUps-menu" style="display: none">
      <div
        id="powerUps-menu-content"
        class="text-center text-light p-4 rounded"
      >
        <h2>Power Ups</h2>
        <p>
          Welcome to the power up menu! Here you can use items and abilities to
          help with your game.
        </p>

        <!-- Add any power up items here (like buttons, descriptions, etc.) -->
        <!-- Power-Up: Reveal Hidden Card -->
        <div class="power-up-item" id="power-up-reveal">
          <div class="power-up-icon-container">
            <!-- Eye icon (for Reveal Hidden Card) -->
            <i class="bi bi-eye-fill power-up-icon"></i>

            <!-- Number of power-ups owned (small circle on top) -->
            <span class="power-up-count" id="power-up-reveal-count">0x</span>
          </div>
          <div class="power-up-text">
            <p>Card Reveal</p>
          </div>
          <button
            class="btn btn-primary w-100 power-up-btn"
            id="use-power-up-reveal-button"
            disabled
          >
            Use power up
          </button>
        </div>

        <!-- Power-Up: Compass Intuition -->
        <div class="power-up-item" id="power-up-compass">
          <div class="power-up-icon-container">
            <i class="bi bi-compass power-up-icon"></i>
            <span class="power-up-count" id="power-up-compass-count">0x</span>
          </div>
          <div class="power-up-text">
            <p>Compass Intuition</p>
          </div>
          <button
            class="btn btn-primary w-100 power-up-btn"
            id="use-power-up-compass"
            disabled
          >
            Use power up
          </button>
        </div>

        <!-- Power-Up: Lightning Strike -->
        <div class="power-up-item" id="power-up-lightning">
          <div class="power-up-icon-container">
            <i class="bi bi-lightning power-up-icon"></i>
            <span class="power-up-count" id="power-up-lightning-count">0x</span>
          </div>
          <div class="power-up-text">
            <p>Lightning Strike</p>
          </div>
          <button
            class="btn btn-primary w-100 power-up-btn"
            id="use-power-up-lightning"
            disabled
          >
            Use power up
          </button>
        </div>

        <!-- Power-Up: Quick Inspect -->
        <div class="power-up-item" id="power-up-quick-inspect">
          <div class="power-up-icon-container">
            <i class="bi bi-search power-up-icon"></i>
            <span class="power-up-count" id="power-up-quick-inspect-count"
              >0x</span
            >
          </div>
          <div class="power-up-text">
            <p>Quick Inspect</p>
          </div>
          <button
            class="btn btn-primary w-100 power-up-btn"
            id="use-power-up-quick-inspect"
            disabled
          >
            Use power up
          </button>
        </div>

        <button id="leave-powerUps-btn" class="btn btn-danger mt-3 w-100">
          Leave Power Ups Menu
        </button>
      </div>
    </div>

    <!-- Quick Inspect overlay -->
    <div
      id="quick-inspect-overlay"
      style="
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 111000;
        background: rgba(0, 0, 0, 0.7);
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        color: white;
      "
    >
      <img
        id="quick-inspect-card"
        src=""
        alt="Next card"
        style="width: 100px; height: auto"
      />
    </div>

    <!-- Lootbox Result overlay -->
    <div
      id="lootbox-result-overlay"
      style="
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 11111000;
        background: rgba(0, 0, 0, 0.7);
        padding: 20px;
        border-radius: 12px;
        text-align: center;
      "
    >
      <div class="power-up-icon-container">
        <i class="bi bi-search power-up-icon" id="lootbox-result-icon"></i>
      </div>
      <div class="power-up-text" id="lootbox-result-text">
        <p>I don't know what you got. (default text)</p>
      </div>
    </div>


    <!-- Settings / Hamburger Menu -->
    <div id="settings-menu">
      <button
        id="settings-toggle"
        class="btn btn-outline-light"
        style="
          position: fixed;
          top: 1rem;
          right: 1rem;
          z-index: 10000;
          background: rgba(33, 37, 41, 0.9);
          border: none;
          border-radius: 0.5rem;
        "
      >
        <i class="bi bi-list" style="font-size: 1.5rem"></i>
      </button>

      <div
        id="settings-panel"
        class="card text-light bg-dark"
        style="
          position: fixed;
          top: 1rem;
          right: calc(1rem + 50px);
          width: 250px;
          display: none;
          z-index: 9999;
          border-radius: 1rem;
          box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        "
      >
        <div class="card-body">
          <h5 class="card-title mb-3">Settings</h5>
          <hr class="border-secondary" />

          <!-- Music Section -->
          <div class="mb-3">
            <h6>Music</h6>
            <button id="music-toggle" class="btn btn-sm btn-success w-100 mb-2">
              Toggle Music
            </button>
            <label for="music-volume" class="form-label small"
              >Music Volume</label
            >
            <input
              type="range"
              id="music-volume"
              min="0"
              max="1"
              step="0.01"
              value="1"
              class="form-range"
            />
          </div>
          <!-- VFX Section -->
          <div class="mb-3">
            <h6>VFX</h6>
            <button id="vfx-toggle" class="btn btn-sm btn-danger w-100 mb-2">
              Mute VFX
            </button>
            <label for="vfx-volume" class="form-label small">VFX Volume</label>
            <input
              type="range"
              id="vfx-volume"
              min="0"
              max="1"
              step="0.01"
              value="1"
              class="form-range"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- ===== SECOND HAMBURGER MENU: SHOP & POWER-UPS ===== -->
    <div id="extras-menu" style="display: none">
      <button
        id="extras-toggle"
        class="btn btn-outline-light"
        style="
          position: fixed;
          top: calc(1rem + 3rem);
          right: 1rem;
          z-index: 10000;
          background: rgba(33, 37, 41, 0.9);
          border: none;
          border-radius: 0.5rem;
        "
      >
        <i class="bi bi-gem" style="font-size: 1.5rem"></i>
        <span
          id="sparkle"
          style="
            display: block;
            position: absolute;
            top: -10px;
            left: -10px;
            animation: sparkle 1s infinite;
          "
          >‚ú®</span
        >
      </button>

      <div
        id="extras-panel"
        class="card text-light bg-dark"
        style="
          position: fixed;
          top: calc(1rem + 3rem);
          right: calc(1rem + 50px);
          width: 250px;
          display: none;
          z-index: 9999;
          border-radius: 1rem;
          box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        "
      >
        <div class="card-body">
          <h5 class="card-title mb-3">Extras</h5>
          <hr class="border-secondary" />

          <!-- Shop Section -->
          <div class="mb-3">
            <button id="btn-shop" class="btn btn-sm btn-success w-100 mb-2">
              Shop
            </button>
            <button id="btn-powerups" class="btn btn-sm btn-primary w-100">
              Use Power-Ups
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Message -->
    <div
      id="toast-message"
      style="
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 1.1rem;
        opacity: 0;
        transition: opacity 0.4s ease;
        z-index: 9999;
      "
    ></div>

    <!-- Link your music script -->
    <script src="js/bg_music.js"></script>

    <!-- Link to Bootstrap's JavaScript bundle for interactive components -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="js/card.js"></script>

    <!-- Link to the JavaScript file containing the Blackjack game logic -->
    <script src="js/blackjack_object.js"></script>

    <!-- Link to the JavaScript file containing the Blackjack advanced game logic -->
    <script src="js/blackjack_object_advanced.js"></script>

    <!-- Link to the JavaScript file for managing game actions and events -->
    <script src="js/blackjack_manager.js"></script>

    <!-- Link to the JavaScript file for managing advanced game actions and events -->
    <script src="js/blackjack_manager_advanced.js"></script>

    <!-- Execute the newGame function when the window loads to start the game -->
    <script>
      window.onload = () => {
        // Page loads, show menu but don't start game yet
        document.getElementById("start-menu").style.display = "flex";

        // Disable gameplay buttons initially
        document.getElementById("card").disabled = true;
        document.getElementById("stand").disabled = true;
        document.getElementById("new_game").disabled = true;

        // Setup menu button logic
        const btnStart = document.getElementById("btn-start");
        const btnStartAdvanced = document.getElementById("btn-start-advanced");
        const btnQuit = document.getElementById("btn-quit");

        btnStart.addEventListener("click", () => {
          primeAudio(); // unlocks sound context
          document.getElementById("start-menu").style.display = "none"; // hide menu
          gameVersion = "basic";
          newGame(gameVersion); // start the actual game
        });

        btnStartAdvanced.addEventListener("click", () => {
          gameVersion = "advanced";
          primeAudio(); // unlocks sound context
          document.getElementById("start-menu").style.display = "none"; // hide menu
          newAdvancedGame(); // start the actual game
        });

        btnQuit.addEventListener("click", () => {
          window.close(); // tries to close tab
          // fallback: navigate away if close is blocked
          setTimeout(() => (window.location.href = "about:blank"), 500);
        });
      };
    </script>
  </body>
</html>
